<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>PDF Viewer</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      height: 100%;
      overflow-y: auto;
    }
    #container {
      width: 100%;
    }
    canvas {
      width: 100%;
      display: block;
      margin-bottom: 12px;
    }
  </style>
</head>
<body>

<div id="container"></div>

<script type="module">
  import * as pdfjsLib from "./pdf.mjs";

  const params = new URLSearchParams(window.location.search);
  const pdfUrl = decodeURIComponent(params.get("url"));

  if (!pdfUrl) {
    document.body.innerHTML =
      "<h3 style='color:white'>PDF URL missing</h3>";
  }

  pdfjsLib.GlobalWorkerOptions.workerSrc = "./pdf.worker.mjs";

  const container = document.getElementById("container");

  const loadingTask = pdfjsLib.getDocument(pdfUrl);

  loadingTask.promise
    .then(async pdf => {
      const totalPages = pdf.numPages;

      for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
        const page = await pdf.getPage(pageNum);

        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");

        const viewport = page.getViewport({ scale: 1.4 });
        canvas.width = viewport.width;
        canvas.height = viewport.height;

        container.appendChild(canvas);

        await page.render({
          canvasContext: context,
          viewport: viewport,
        }).promise;
      }
    })
    .catch(err => {
      document.body.innerHTML =
        "<pre style='color:red'>" + err.message + "</pre>";
    });
</script>

</body>
</html>
